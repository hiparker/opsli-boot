<configuration>

    <!-- ========================== è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼è¯´æ˜Ž================================ -->
    <!-- %p è¾“å‡ºä¼˜å…ˆçº§ï¼Œå³DEBUGï¼ŒINFOï¼ŒWARNï¼ŒERRORï¼ŒFATAL -->
    <!-- %r è¾“å‡ºè‡ªåº”ç”¨å¯åŠ¨åˆ°è¾“å‡ºè¯¥logä¿¡æ¯è€—è´¹çš„æ¯«ç§’æ•°  -->
    <!-- %c è¾“å‡ºæ‰€å±žçš„ç±»ç›®ï¼Œé€šå¸¸å°±æ˜¯æ‰€åœ¨ç±»çš„å…¨å -->
    <!-- %t è¾“å‡ºäº§ç”Ÿè¯¥æ—¥å¿—äº‹ä»¶çš„çº¿ç¨‹å -->
    <!-- %n è¾“å‡ºä¸€ä¸ªå›žè½¦æ¢è¡Œç¬¦ï¼ŒWindowså¹³å°ä¸º"/r/n"ï¼ŒUnixå¹³å°ä¸º"/n" -->
    <!-- %d è¾“å‡ºæ—¥å¿—æ—¶é—´ç‚¹çš„æ—¥æœŸæˆ–æ—¶é—´ï¼Œé»˜è®¤æ ¼å¼ä¸ºISO8601ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶åŽæŒ‡å®šæ ¼å¼ï¼Œæ¯”å¦‚ï¼š%d{yyy MMM dd HH:mm:ss,SSS}ï¼Œè¾“å‡ºç±»ä¼¼ï¼š2002å¹´10æœˆ18æ—¥ 22ï¼š10ï¼š28ï¼Œ921  -->
    <!-- %l è¾“å‡ºæ—¥å¿—äº‹ä»¶çš„å‘ç”Ÿä½ç½®ï¼ŒåŒ…æ‹¬ç±»ç›®åã€å‘ç”Ÿçš„çº¿ç¨‹ï¼Œä»¥åŠåœ¨ä»£ç ä¸­çš„è¡Œæ•°ã€‚ä¸¾ä¾‹ï¼šTestlo4.main(TestLog4.java:10)  -->
    <!-- ========================================================================== -->

    <!-- ========================== è¾“å‡ºæ–¹å¼è¯´æ˜Ž================================ -->
    <!-- Log4jæä¾›çš„appenderæœ‰ä»¥ä¸‹å‡ ç§:  -->
    <!-- org.apache.log4j.ConsoleAppender(æŽ§åˆ¶å°),  -->
    <!-- org.apache.log4j.FileAppender(æ–‡ä»¶),  -->
    <!-- org.apache.log4j.DailyRollingFileAppender(æ¯å¤©äº§ç”Ÿä¸€ä¸ªæ—¥å¿—æ–‡ä»¶), -->
    <!-- org.apache.log4j.RollingFileAppender(æ–‡ä»¶å¤§å°åˆ°è¾¾æŒ‡å®šå°ºå¯¸çš„æ—¶å€™äº§ç”Ÿä¸€ä¸ªæ–°çš„æ–‡ä»¶),  -->
    <!-- org.apache.log4j.WriterAppender(å°†æ—¥å¿—ä¿¡æ¯ä»¥æµæ ¼å¼å‘é€åˆ°ä»»æ„æŒ‡å®šçš„åœ°æ–¹)   -->
    <!-- ========================================================================== -->

    <!--æ—¥å¿—æ ¼å¼åº”ç”¨spring booté»˜è®¤çš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ›´æ”¹-->
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>

    <springProperty scope="context" name="app_name" source="spring.application.name" defaultValue="opsli-boot"/>
    <springProperty scope="context" name="log_level" source="logging.level.root"/>
    <springProperty scope="context" name="file_path" source="logging.file.path" defaultValue=""/>

    <property name="log_path" value="${file_path}logs/${app_name}"/>
    <property name="file_size" value="64MB"/>
    <property name="file_count" value="50"/>
    <property name="maxHistory" value="15"/>
    <!-- å¼‚æ­¥ç¼“å†²é˜Ÿåˆ—çš„æ·±åº¦,è¯¥å€¼ä¼šå½±å“æ€§èƒ½.é»˜è®¤å€¼ä¸º256 -->
    <property name="queueSize" value="512"/>

    <!-- æŽ§åˆ¶å°æ—¥å¿— -->
    <appender name="consoleAppender" class="ch.qos.logback.core.ConsoleAppender">
        <!-- æ—¥å¿—æ–‡ä»¶çš„æ ¼å¼ -->
        <encoder>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <!-- DEBUGæ–‡ä»¶æ—¥å¿— -->
    <appender name="FILE_DEBUG" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>DEBUG</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <file>${log_path}/${app_name}_debug.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${log_path}/history/${app_name}_debug.log.%d{yyyy-MM-dd}.zip</fileNamePattern>
            <maxHistory>${maxHistory}</maxHistory>
        </rollingPolicy>

        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-4relative [%thread] %-5level %logger{35} - %msg%n</pattern>
            <charset>UTF-8</charset>
        </encoder>

        <!-- è¿½åŠ æ–¹å¼è®°å½•æ—¥å¿— -->
        <append>true</append>
    </appender>

    <!-- INFOæ–‡ä»¶æ—¥å¿— - ðŸ”§ ä¿®å¤äº† Spring Boot 3.x å…¼å®¹æ€§é—®é¢˜ -->
    <appender name="FILE_INFO" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>DENY</onMatch>
            <onMismatch>ACCEPT</onMismatch>
        </filter>

        <file>${log_path}/${app_name}_info.log</file>

        <!-- ðŸš¨ ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„ Spring Boot 3.x å…¼å®¹æ»šåŠ¨ç­–ç•¥ -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- ä¿®å¤æ–‡ä»¶åæ¨¡å¼ï¼š%i ç´¢å¼•ä½ç½®è°ƒæ•´ -->
            <fileNamePattern>${log_path}/history/${app_name}_info.log.%d{yyyy-MM-dd}.%i.zip</fileNamePattern>
            <maxHistory>30</maxHistory>
            <!-- æœ€å¤§64MB è¶…è¿‡æœ€å¤§å€¼ï¼Œä¼šé‡æ–°å»ºä¸€ä¸ªæ–‡ä»¶ -->
            <maxFileSize>${file_size}</maxFileSize>
            <!-- æ‰€æœ‰å½’æ¡£æ–‡ä»¶çš„æ€»å¤§å°é™åˆ¶ -->
            <totalSizeCap>10GB</totalSizeCap>
        </rollingPolicy>

        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss:SSS} %-5level [%thread] %logger{50}-%L %msg%n</pattern>
            <charset>UTF-8</charset>
        </encoder>

        <!-- è¿½åŠ æ–¹å¼è®°å½•æ—¥å¿— -->
        <append>true</append>
    </appender>

    <!-- è­¦å‘Šæ–‡ä»¶æ—¥å¿— -->
    <appender name="FILE_WARN" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>WARN</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <file>${log_path}/${app_name}_warn.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${log_path}/history/${app_name}_warn.log.%d{yyyy-MM-dd}.zip</fileNamePattern>
            <maxHistory>${maxHistory}</maxHistory>
        </rollingPolicy>

        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-4relative [%thread] %-5level %logger{35} - %msg%n</pattern>
            <charset>UTF-8</charset>
        </encoder>

        <!-- è¿½åŠ æ–¹å¼è®°å½•æ—¥å¿— -->
        <append>true</append>
    </appender>

    <!-- é”™è¯¯æ–‡ä»¶æ—¥å¿— -->
    <appender name="FILE_ERROR" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <file>${log_path}/${app_name}_error.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${log_path}/history/${app_name}_error.log.%d{yyyy-MM-dd}.zip</fileNamePattern>
            <maxHistory>${maxHistory}</maxHistory>
        </rollingPolicy>

        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-4relative [%thread] %-5level %logger{35} - %msg%n</pattern>
            <charset>UTF-8</charset>
        </encoder>

        <!-- è¿½åŠ æ–¹å¼è®°å½•æ—¥å¿— -->
        <append>true</append>
    </appender>

    <!-- å¼‚æ­¥æ—¥å¿—é…ç½® -->
    <appender name="ASYNC_LOG_DEBUG" class="ch.qos.logback.classic.AsyncAppender">
        <!-- ä¸ä¸¢å¤±æ—¥å¿—.é»˜è®¤çš„,å¦‚æžœé˜Ÿåˆ—çš„80%å·²æ»¡,åˆ™ä¼šä¸¢å¼ƒTRACTã€DEBUGã€INFOçº§åˆ«çš„æ—¥å¿— -->
        <discardingThreshold>0</discardingThreshold>
        <!-- æ›´æ”¹é»˜è®¤çš„é˜Ÿåˆ—çš„æ·±åº¦,è¯¥å€¼ä¼šå½±å“æ€§èƒ½.é»˜è®¤å€¼ä¸º256 -->
        <queueSize>${queueSize}</queueSize>
        <!-- æ·»åŠ è°ƒç”¨è€…æ•°æ®ï¼Œç”¨äºŽæ›´å¥½çš„æ—¥å¿—è·Ÿè¸ª -->
        <includeCallerData>false</includeCallerData>
        <appender-ref ref="FILE_DEBUG"/>
    </appender>

    <appender name="ASYNC_LOG_INFO" class="ch.qos.logback.classic.AsyncAppender">
        <!-- ä¸ä¸¢å¤±æ—¥å¿—.é»˜è®¤çš„,å¦‚æžœé˜Ÿåˆ—çš„80%å·²æ»¡,åˆ™ä¼šä¸¢å¼ƒTRACTã€DEBUGã€INFOçº§åˆ«çš„æ—¥å¿— -->
        <discardingThreshold>0</discardingThreshold>
        <!-- æ›´æ”¹é»˜è®¤çš„é˜Ÿåˆ—çš„æ·±åº¦,è¯¥å€¼ä¼šå½±å“æ€§èƒ½.é»˜è®¤å€¼ä¸º256 -->
        <queueSize>${queueSize}</queueSize>
        <includeCallerData>false</includeCallerData>
        <appender-ref ref="FILE_INFO"/>
    </appender>

    <appender name="ASYNC_LOG_WARN" class="ch.qos.logback.classic.AsyncAppender">
        <!-- ä¸ä¸¢å¤±æ—¥å¿—.é»˜è®¤çš„,å¦‚æžœé˜Ÿåˆ—çš„80%å·²æ»¡,åˆ™ä¼šä¸¢å¼ƒTRACTã€DEBUGã€INFOçº§åˆ«çš„æ—¥å¿— -->
        <discardingThreshold>0</discardingThreshold>
        <!-- æ›´æ”¹é»˜è®¤çš„é˜Ÿåˆ—çš„æ·±åº¦,è¯¥å€¼ä¼šå½±å“æ€§èƒ½.é»˜è®¤å€¼ä¸º256 -->
        <queueSize>${queueSize}</queueSize>
        <includeCallerData>false</includeCallerData>
        <appender-ref ref="FILE_WARN"/>
    </appender>

    <appender name="ASYNC_LOG_ERROR" class="ch.qos.logback.classic.AsyncAppender">
        <!-- ä¸ä¸¢å¤±æ—¥å¿—.é»˜è®¤çš„,å¦‚æžœé˜Ÿåˆ—çš„80%å·²æ»¡,åˆ™ä¼šä¸¢å¼ƒTRACTã€DEBUGã€INFOçº§åˆ«çš„æ—¥å¿— -->
        <discardingThreshold>0</discardingThreshold>
        <!-- æ›´æ”¹é»˜è®¤çš„é˜Ÿåˆ—çš„æ·±åº¦,è¯¥å€¼ä¼šå½±å“æ€§èƒ½.é»˜è®¤å€¼ä¸º256 -->
        <queueSize>${queueSize}</queueSize>
        <includeCallerData>false</includeCallerData>
        <appender-ref ref="FILE_ERROR"/>
    </appender>

    <!-- ç‰¹å®šåŒ…çš„æ—¥å¿—çº§åˆ«é…ç½® - Spring Boot 3.x ä¼˜åŒ– -->
    <logger name="org.springframework" level="INFO" additivity="false">
        <appender-ref ref="consoleAppender"/>
    </logger>

    <logger name="org.mybatis" level="DEBUG" additivity="false">
        <appender-ref ref="consoleAppender"/>
        <appender-ref ref="ASYNC_LOG_DEBUG"/>
    </logger>

    <logger name="com.baomidou.mybatisplus" level="DEBUG" additivity="false">
        <appender-ref ref="consoleAppender"/>
        <appender-ref ref="ASYNC_LOG_DEBUG"/>
    </logger>

    <!-- localçŽ¯å¢ƒï¼Œåªè¾“å‡ºæŽ§åˆ¶å°æ—¥å¿— -->
    <springProfile name="local">
        <root level="${log_level}">
            <appender-ref ref="consoleAppender"/>
        </root>
    </springProfile>

    <!-- devçŽ¯å¢ƒ -->
    <springProfile name="dev">
        <root level="${log_level}">
            <appender-ref ref="consoleAppender"/>
            <appender-ref ref="ASYNC_LOG_DEBUG"/>
            <appender-ref ref="ASYNC_LOG_INFO"/>
            <appender-ref ref="ASYNC_LOG_WARN"/>
            <appender-ref ref="ASYNC_LOG_ERROR"/>
        </root>
    </springProfile>

    <!-- testçŽ¯å¢ƒ -->
    <springProfile name="test">
        <root level="${log_level}">
            <appender-ref ref="consoleAppender"/>
            <appender-ref ref="ASYNC_LOG_INFO"/>
            <appender-ref ref="ASYNC_LOG_WARN"/>
            <appender-ref ref="ASYNC_LOG_ERROR"/>
        </root>
    </springProfile>

    <!-- prodçŽ¯å¢ƒ -->
    <springProfile name="prod">
        <root level="WARN">
            <!-- ç”Ÿäº§çŽ¯å¢ƒå»ºè®®ä¸è¾“å‡ºæŽ§åˆ¶å°æ—¥å¿—ï¼Œå‡å°‘æ€§èƒ½æ¶ˆè€— -->
            <!-- <appender-ref ref="consoleAppender"/> -->
            <appender-ref ref="ASYNC_LOG_INFO"/>
            <appender-ref ref="ASYNC_LOG_WARN"/>
            <appender-ref ref="ASYNC_LOG_ERROR"/>
        </root>
    </springProfile>

    <!-- é»˜è®¤é…ç½® - å¦‚æžœæ²¡æœ‰åŒ¹é…çš„ profile -->
    <!-- localçŽ¯å¢ƒï¼Œåªè¾“å‡ºæŽ§åˆ¶å°æ—¥å¿— -->
    <springProfile name="local">
        <root level="${log_level}">
            <appender-ref ref="consoleAppender"/>
        </root>
    </springProfile>

    <!-- devçŽ¯å¢ƒ -->
    <springProfile name="dev">
        <root level="${log_level}">
            <appender-ref ref="consoleAppender"/>
            <appender-ref ref="ASYNC_LOG_DEBUG"/>
            <appender-ref ref="ASYNC_LOG_INFO"/>
            <appender-ref ref="ASYNC_LOG_WARN"/>
            <appender-ref ref="ASYNC_LOG_ERROR"/>
        </root>
    </springProfile>

    <!-- testçŽ¯å¢ƒ -->
    <springProfile name="test">
        <root level="${log_level}">
            <appender-ref ref="consoleAppender"/>
            <appender-ref ref="ASYNC_LOG_INFO"/>
            <appender-ref ref="ASYNC_LOG_WARN"/>
            <appender-ref ref="ASYNC_LOG_ERROR"/>
        </root>
    </springProfile>

    <!-- prodçŽ¯å¢ƒ -->
    <springProfile name="prod">
        <root level="WARN">
            <!-- ç”Ÿäº§çŽ¯å¢ƒå»ºè®®ä¸è¾“å‡ºæŽ§åˆ¶å°æ—¥å¿—ï¼Œå‡å°‘æ€§èƒ½æ¶ˆè€— -->
            <!-- <appender-ref ref="consoleAppender"/> -->
            <appender-ref ref="ASYNC_LOG_INFO"/>
            <appender-ref ref="ASYNC_LOG_WARN"/>
            <appender-ref ref="ASYNC_LOG_ERROR"/>
        </root>
    </springProfile>

</configuration>
